<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Ultimate Anime Dashboard — Battles</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#061126; --panel:#071827; --muted:#b8d9ef;
      --card-grad: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(0,0,0,0.03));
      --accent-1:#7ef9a6; --accent-2:#ff9ac2; --accent-3:#ffd36a; --accent-4:#9bd0ff;
      --accent-5:#b3a0ff; --accent-6:#8cffb1; --accent-7:#ffc6a6; --accent-8:#c8fffb;
      --accent-9:#ffb3f5; --accent-10:#ffd6b8; --accent-11:#8fd1ff; --accent-12:#a7ffcf;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background: radial-gradient(900px 420px at 8% 10%, rgba(140,180,255,0.03), transparent 10%), linear-gradient(180deg,#021126 6%, #061126 84%);
      color:#eaf6ff; display:flex;align-items:flex-start;justify-content:center;padding:18px;
    }
    .app{width:1300px;max-width:100%;border-radius:14px;padding:14px;background:var(--panel);border:1px solid rgba(255,255,255,0.03);box-shadow:0 20px 60px rgba(2,6,23,0.7);position:relative;overflow:hidden}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:8px 6px}
    h1{margin:0;font-size:20px} p.lead{margin:0;color:var(--muted);font-size:13px}

    .controls{display:flex;gap:10px;align-items:center}
    button{padding:8px 12px;border-radius:10px;border:none;background:linear-gradient(90deg,#7bf3c6,#8ac8ff);color:#042a1f;font-weight:700;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}

    .main{display:flex;gap:14px;padding:12px 6px}
    .left{flex:1}
    .right{width:460px}

    /* roster grid (3x5) */
    .grid{display:grid;grid-template-columns: repeat(5, 1fr);gap:12px;padding:8px;max-height:560px;overflow:auto}
    .card{background:var(--card-grad);border-radius:12px;padding:10px;min-height:150px;position:relative;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;align-items:center;gap:6px}
    .name{font-weight:800;color:#fff;font-size:13px;text-align:center}
    .title{font-size:11px;color:var(--muted);text-align:center}

    /* arena */
    .arena{height:220px;border-radius:10px;background:linear-gradient(180deg,#081426,#061126);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
    .match-card{display:flex;gap:24px;align-items:center;justify-content:center}
    .fighter{display:flex;flex-direction:column;align-items:center;gap:6px}
    .fighter .face{width:86px;height:86px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.06));display:flex;align-items:center;justify-content:center;font-size:28px}
    .vs{font-size:28px;color:var(--muted)}

    .battle-log{margin-top:10px;height:200px;overflow:auto;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);font-size:13px;color:var(--muted)}

    .matrix-wrap{margin-top:12px;overflow:auto;border-radius:8px;background:rgba(255,255,255,0.02);padding:8px;border:1px solid rgba(255,255,255,0.03)}
    table.battle-matrix{border-collapse:collapse;width:100%;min-width:880px}
    table.battle-matrix th, table.battle-matrix td{border:1px solid rgba(255,255,255,0.03);padding:6px;text-align:center;font-size:12px}
    th{background:rgba(255,255,255,0.02);position:sticky;top:0;z-index:3}

    footer{margin-top:10px;color:var(--muted);font-size:13px;text-align:center}

    @media (max-width:1200px){ .grid{grid-template-columns:repeat(3,1fr)} .right{width:360px} }
    @media (max-width:760px){ .grid{grid-template-columns:repeat(2,1fr)} .right{width:320px} }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div>
        <h1>Ultimate Anime Dashboard — Battles</h1>
        <p class="lead">Strategy arena: 15 characters, 15×15 battle matrix, and "Battle of the Week" playthrough.</p>
      </div>
      <div class="controls">
        <button id="startAll" class="">▶️ Sim All Battles</button>
        <button id="startWeek" class="">⚔️ Battle of the Week</button>
        <button id="stopBattle" class="secondary">⏹️ Stop</button>
      </div>
    </header>

    <div class="main">
      <div class="left">
        <div class="grid" id="grid"></div>

        <div class="matrix-wrap">
          <div style="font-weight:800;margin-bottom:8px">15×15 Battle Matrix (click a cell to simulate single match)</div>
          <div style="overflow:auto"><table class="battle-matrix" id="matrix"></table></div>
        </div>
      </div>

      <div class="right">
        <div class="arena" id="arena">
          <div class="match-card" id="matchCard" aria-live="polite"></div>
        </div>

        <div class="battle-log" id="battleLog"></div>
      </div>
    </div>

    <footer>Matches are randomized using hidden power stats. Battle drums play during fights.</footer>
  </div>

<script>
(() => {
  // characters array (same 15)
  const members = [
    {id:'pham', name:'Phạm Hoàng Hải', short:'Pham', color:'--accent-1'},
    {id:'bui_huyen_mai', name:'Bùi Huyền Mai', short:'HuyenMai', color:'--accent-2'},
    {id:'duc_viet_bui', name:'Đức Việt Bùi', short:'DucViet', color:'--accent-3'},
    {id:'trinh_ngoc_hung', name:'Trịnh Ngọc Hưng', short:'Hung', color:'--accent-4'},
    {id:'tran_duc_manh', name:'Trần Đức Mạnh', short:'DucManh', color:'--accent-5'},
    {id:'nguyen_khanh_bang', name:'Nguyễn Khánh Bằng', short:'KhanhBang', color:'--accent-6'},
    {id:'aryan_panicker', name:'Aryan Panicker', short:'Aryan', color:'--accent-7'},
    {id:'ta_thu_hau', name:'Tạ Thu Hậu', short:'ThuHau', color:'--accent-8'},
    {id:'aittaty', name:'Aittaty Kyzybek', short:'Aittaty', color:'--accent-9'},
    {id:'ali_akram', name:'Ali Akram', short:'Ali', color:'--accent-10'},
    {id:'kazuki', name:'Kazuki', short:'Kazuki', color:'--accent-11'},
    {id:'inukami', name:'Inukami-senpai', short:'Inukami', color:'--accent-12'},
    {id:'anoush', name:'Anoush KP', short:'Anoush', color:'--accent-3'},
    {id:'nguyen_hoang_anh', name:'Nguyen Hoang Anh', short:'HoangAnh', color:'--accent-5'},
    {id:'usato', name:'Usato (Main)', short:'Usato', color:'--accent-6'}
  ];

  const grid = document.getElementById('grid');
  const matrix = document.getElementById('matrix');
  const matchCard = document.getElementById('matchCard');
  const battleLog = document.getElementById('battleLog');
  const arena = document.getElementById('arena');

  // hidden power stats for each player (randomized but stable per session)
  const powers = {};
  members.forEach(m => { powers[m.id] = 50 + Math.floor(Math.random()*51); }); // 50-100

  // render roster cards
  members.forEach(m => {
    const card = document.createElement('div'); card.className='card'; card.id='card_'+m.id;
    const name = document.createElement('div'); name.className='name'; name.textContent = m.name;
    const title = document.createElement('div'); title.className='title'; title.textContent = `Power ${powers[m.id]}`;
    card.appendChild(name); card.appendChild(title);
    grid.appendChild(card);
  });

  // build 15x15 matrix table header
  function buildMatrix(){
    matrix.innerHTML = '';
    const headerRow = document.createElement('tr');
    headerRow.appendChild(document.createElement('th')); // corner
    members.forEach(m => { const th = document.createElement('th'); th.textContent = m.short; headerRow.appendChild(th); });
    matrix.appendChild(headerRow);
    members.forEach((rowM, r) => {
      const tr = document.createElement('tr');
      const th = document.createElement('th'); th.textContent = rowM.short; tr.appendChild(th);
      members.forEach((colM, c) => {
        const td = document.createElement('td');
        td.dataset.a = rowM.id; td.dataset.b = colM.id;
        if(rowM.id === colM.id){ td.textContent = '—'; td.style.background='rgba(255,255,255,0.01)'; }
        else{
          td.innerHTML = `<button class="cellBtn" style="padding:4px 6px;border-radius:6px;border:none;background:linear-gradient(90deg,#fff2,#fff0);cursor:pointer">Fight</button>`;
          td.querySelector('button').addEventListener('click', ()=> simulateMatch(rowM.id, colM.id));
        }
        tr.appendChild(td);
      });
      matrix.appendChild(tr);
    });
  }

  buildMatrix();

  // helper: random gaussian-ish advantage
  function matchOutcome(aPower, bPower){
    // base win chance proportionate to power, add randomness
    const a = aPower * (0.85 + Math.random()*0.3); // 0.85-1.15 multiplier
    const b = bPower * (0.85 + Math.random()*0.3);
    if(Math.abs(a-b) < 6){
      // close match, small RNG decides
      return Math.random() > 0.5 ? 'a' : 'b';
    }
    return a > b ? 'a' : 'b';
  }

  // percussion drum for battles using WebAudio (light drums)
  let audioCtx = null;
  function playDrumPattern(durationMs=1200){
    try{
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const t0 = audioCtx.currentTime + 0.02;
      for(let i=0;i<4;i++){
        const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
        o.type = 'sine'; o.frequency.value = 80 + Math.random()*40;
        g.gain.value = 0.0005;
        o.connect(g); g.connect(audioCtx.destination);
        o.start(t0 + i*0.18);
        g.gain.linearRampToValueAtTime(0.05, t0 + i*0.18 + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, t0 + i*0.18 + 0.18);
        o.stop(t0 + i*0.18 + 0.19);
      }
    }catch(e){ console.log('drum err', e); }
  }

  // simulate a single match with animations and drum
  let battleRunning = false;
  async function simulateMatch(aId, bId){
    if(battleRunning) return;
    battleRunning = true;
    // prepare UI
    matchCard.innerHTML = '';
    const a = members.find(m=>m.id===aId); const b = members.find(m=>m.id===bId);
    const fa = document.createElement('div'); fa.className='fighter'; fa.innerHTML = `<div class="face">${a.short.slice(0,2)}</div><div style="font-weight:800">${a.short}</div><div style="font-size:12px;color:var(--muted)">P:${powers[aId]}</div>`;
    const fb = document.createElement('div'); fb.className='fighter'; fb.innerHTML = `<div class="face">${b.short.slice(0,2)}</div><div style="font-weight:800">${b.short}</div><div style="font-size:12px;color:var(--muted)">P:${powers[bId]}</div>`;
    const vs = document.createElement('div'); vs.className='vs'; vs.textContent='VS';
    matchCard.appendChild(fa); matchCard.appendChild(vs); matchCard.appendChild(fb);

    // fade-in effect
    matchCard.style.opacity = '0'; matchCard.animate([{opacity:0},{opacity:1}],{duration:300,fill:'forwards'});
    // drum pattern
    playDrumPattern(900);
    // short "clash" visual
    const clash = document.createElement('div'); clash.style.position='absolute'; clash.style.width='40%'; clash.style.height='24%'; clash.style.left='30%'; clash.style.top='30%'; clash.style.borderRadius='12px'; clash.style.background='radial-gradient(circle, rgba(255,255,255,0.06), rgba(255,255,255,0))'; clash.style.pointerEvents='none'; arena.appendChild(clash);
    clash.animate([{opacity:0},{opacity:1},{opacity:0}],{duration:900}).onfinish = ()=> clash.remove();
    // wait a bit for dramatic effect
    await new Promise(r=>setTimeout(r,900));

    const outcome = matchOutcome(powers[aId], powers[bId]);
    const winner = outcome==='a' ? a : b;
    const loser = outcome==='a' ? b : a;
    // update battle log and matrix cell
    const time = new Date().toLocaleTimeString();
    const entry = document.createElement('div'); entry.innerHTML = `<strong>${time}</strong> — ${a.short} vs ${b.short} → <strong>${winner.short} wins</strong> (P:${powers[winner.id]} vs ${powers[loser.id]})`;
    battleLog.prepend(entry);
    // mark matrix cell briefly
    const cells = Array.from(document.querySelectorAll('td'));
    const cell = cells.find(c => c.dataset.a===aId && c.dataset.b===bId);
    if(cell){
      cell.style.background = 'linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01))';
      // show result overlay
      cell.innerHTML = `<div style="font-weight:700;color:${ outcome==='a' ? '#a6ffcc' : '#ffd6b8' }">${winner.short}</div>`;
      setTimeout(()=> { cell.innerHTML = `<button class="cellBtn" style="padding:4px 6px;border-radius:6px;border:none;background:linear-gradient(90deg,#fff2,#fff0);cursor:pointer">Fight</button>`; cell.querySelector('button').addEventListener('click', ()=> simulateMatch(aId,bId)); cell.style.background=''; }, 2200);
    }

    battleRunning = false;
  }

  // simulate all matches sequentially (i<j)
  document.getElementById('startAll').addEventListener('click', async ()=>{
    if(battleRunning) return;
    const pairs = [];
    for(let i=0;i<members.length;i++){
      for(let j=0;j<members.length;j++){
        if(i===j) continue;
        pairs.push([members[i].id, members[j].id]);
      }
    }
    // run pairs sequentially with small delay
    for(const [a,b] of pairs){
      if(battleStopRequested) break;
      await simulateMatch(a,b);
      await new Promise(r=>setTimeout(r,300));
    }
    battleStopRequested = false;
  });

  // Build a "Battle of the Week" playthrough: simulate all unique unordered pairs (i<j) but order by randomized shuffle
  function allUniquePairs(){
    const pairs=[];
    for(let i=0;i<members.length;i++){
      for(let j=i+1;j<members.length;j++){
        pairs.push([members[i].id,members[j].id]);
      }
    }
    // shuffle
    for(let k=pairs.length-1;k>0;k--){
      const r = Math.floor(Math.random()*(k+1)); [pairs[k],pairs[r]]=[pairs[r],pairs[k]];
    }
    return pairs;
  }

  let battleStopRequested = false;
  document.getElementById('stopBattle').addEventListener('click', ()=>{ battleStopRequested = true; });

  document.getElementById('startWeek').addEventListener('click', async ()=>{
    if(battleRunning) return;
    battleStopRequested = false;
    // pick current week from stored UI if present (we'll simply run through shuffled pairs representing this week's battles)
    const pairs = allUniquePairs();
    battleLog.prepend(document.createElement('div')).textContent = `--- Battle of the Week begins (${new Date().toLocaleString()}) ---`;
    // play light battle drums loop while running
    const drumInterval = setInterval(()=> playDrumPattern(1000), 1200);
    for(const [a,b] of pairs){
      if(battleStopRequested) break;
      await simulateMatch(a,b);
      await new Promise(r=>setTimeout(r,500));
    }
    clearInterval(drumInterval);
    battleLog.prepend(document.createElement('div')).textContent = `--- Battle of the Week ends ---`;
    battleStopRequested = false;
  });

  // clicking a matrix cell created event earlier; already wired in buildMatrix()

  // initial render and utilities
  buildMatrix();
  battleLog.textContent = 'Battle log (most recent at top). Click cells or use controls.';

  // show initial arena placeholder
  matchCard.innerHTML = '<div style="color:var(--muted)">No battle running — click "Battle of the Week" or a cell to start a fight.</div>';

})(); 
</script>
</body>
</html>
